<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>본캐찾기</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Apple SD Gothic Neo', 'Malgun Gothic', '맑은 고딕', sans-serif;
            margin: 0;
            background-color: #f4f7f6;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding-top: 8vh;
            box-sizing: border-box;
        }
        main {
            width: 100%;
            max-width: 680px;
            padding: 20px;
            box-sizing: border-box;
            text-align: center;
            position: relative;
        }
        button {
            padding: 12px 28px;
            font-size: 1.1rem;
            font-weight: bold;
            color: white;
            background-color: #007bff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #0056b3;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }

        /* --- 언어 선택 목록 상자 스타일 수정 --- */
        .language-selector {
            position: absolute;
            top: 15px;
            right: 20px;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 8px; /* '언어:' 레이블과 목록 상자 사이 간격 */
        }
        .language-selector label {
            font-size: 1rem; /* 성별 레이블과 동일하게 1rem으로 설정 */
            color: #333;
            font-weight: 500;
        }
        .language-selector select {
            padding: 8px; /* 성별 목록 상자와 동일하게 조정 */
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 1rem; /* 성별 목록 상자와 동일하게 1rem으로 설정 */
            cursor: pointer;
            background-color: white;
            /* appearance: none; */ /* 브라우저 기본 드롭다운 화살표를 표시하도록 제거 */
            min-width: 80px;
        }
        /* --- (수정 끝) --- */


        #start-page h1 {
            margin-top: 30px;
            margin-bottom: 30px;
            height: 2.5em;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .form-box {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            border: 1px solid #e0e0e0;
            padding: 30px;
            border-radius: 8px;
            background-color: #f9f9f9;
            width: 530px;
            box-sizing: border-box;
            min-height: 160px;
        }
        .form-inner-container {
            display: inline-flex;
            flex-direction: column;
            gap: 15px;
            text-align: left;
            margin: auto;
            width: 100%;
            position: relative;
            left: -15px;
        }
        .form-row {
            display: flex;
            gap: 20px;
        }
        .form-row .input-group {
            flex: 1;
        }
        .input-group {
            font-size: 1rem;
            display: flex;
            align-items: center;
        }
        .input-group label {
            white-space: nowrap;
            margin-right: 8px;
            min-width: 65px;
            text-align: right;
        }
        .input-group label,
        .input-group select,
        .input-group input[type="text"] {
            font-size: 1rem;
        }
        .input-group select,
        .input-group input[type="text"] {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            flex: 1;
            box-sizing: border-box;
        }

        .button-container {
            margin-top: 30px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        #start-btn {
            min-width: 220px;
            height: 50px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        #prev-btn, #home-btn, #restart-btn {
            background-color: #6c757d;
        }
        #prev-btn:hover, #home-btn:hover, #restart-btn:hover {
            background-color: #5a6268;
        }


        .question-container { margin: 20px auto; }
        .progress-bar { width: 100%; background-color: #e0e0e0; border-radius: 10px; overflow: hidden; margin-bottom: 10px; }
        .progress { height: 10px; background-color: #007bff; width: 0%; transition: width 0.3s; }
        .progress-text { font-size: 0.9rem; color: #666; margin-bottom: 10px; }
        .question-box { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .question-box h2 {
            font-size: 1.4rem;
            margin-top: 0;
            margin-bottom: 20px;
            text-align: left;
            word-break: keep-all;
            height: 3.5em;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-start;
            gap: 0.2em;
        }
        .question-image { width: 100%; height: auto; border-radius: 8px; margin-bottom: 25px; }

        .options {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }
        .options .option-input { display: none; }
        .options .option-label {
            padding: 15px 2px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            background-color: #f9f9f9;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 30px;
            white-space: nowrap;
        }

        .options .option-label:hover { background-color: #e9e9f9; }
        .options .option-input:checked + .option-label {
            background-color: #007bff; color: white; border-color: #0056b3; font-weight: bold;
        }

        .question-nav {
            display: flex;
            gap: 2px;
            margin-bottom: 20px;
        }
        .nav-item {
            flex: 1;
            height: 25px;
            border-radius: 4px;
            background-color: #e0e0e0;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .nav-item:hover {
            background-color: #ccc;
        }
        .nav-item.active {
            background-color: #007bff;
            color: white;
            font-weight: bold;
        }
        .nav-item.unanswered {
            background-color: #ef4444;
            color: white;
        }
        .nav-item.answered {
            background-color: #22c55e;
            color: white;
        }


        .result-box {
            margin: 40px auto; padding: 30px; background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: left;
        }
        .result-box h2 {
            margin-top: 0;
            margin-bottom: 5px;
            font-size: 2rem;
            text-align: center;
        }
        .result-box p {
            text-align: center;
            color: #555;
            font-size: 1.1rem;
            margin-top: 5px;
            margin-bottom: 15px;
        }

        .result-section {
            background-color: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 15px;
        }
        .result-section h3 {
            margin-top: -5px;
            margin-bottom: 5px;
            font-size: 1.2rem;
            color: #333;
            text-align: center;
            border-bottom: 2px solid #eee;
            padding-bottom: 8px;
        }

        .percentage-container { display: flex; height: 30px; border-radius: 15px; overflow: hidden; margin-bottom: 10px; }
        .teto-bar { background-color: #4dabf7; }
        .egen-bar { background-color: #ff8787; }
        .percentage-bar { display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; transition: width 0.5s ease-in-out; }
        .percentage-labels { display: flex; justify-content: space-between; font-size: 0.9rem; padding: 0 5px; }

        .result-section h4 {
            font-size: 1.1rem;
            color: #111;
            margin-top: 20px;
            margin-bottom: 10px;
            text-align: center;
            font-weight: bold;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .keyword-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px 10px;
            margin-top: 15px;
            padding: 0 10px;
        }
        .keyword-tag {
            background-color: #e9ecef;
            color: #495057;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.95rem;
            font-weight: bold;
            white-space: normal;
            text-align: left;
            line-height: 1.4;
            max-width: 100%;
        }

        .mbti-tags {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 10px 0;
            max-width: 400px;
            margin: 0 auto;
            transform: translateX(-16px);
        }
        .mbti-tag-item {
            width: 100%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            text-align: center;
        }
        .mbti-tag {
            background-color: #007bff;
            color: white;
            padding: 5px 12px;
            border-radius: 5px;
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 8px;
            display: inline-block;
        }
        .mbti-description {
            font-size: 0.95rem;
            color: #555;
            line-height: 1.4;
            text-align: center;
            word-break: keep-all;
            margin: 0;
        }


        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-overlay.visible {
            display: flex;
        }
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        .modal-content h3 {
            margin-top: 0;
            font-size: 1.4rem;
        }
        .modal-content p {
            margin-bottom: 25px;
            font-size: 1.1rem;
            color: #333;
            word-break: keep-all;
            white-space: nowrap;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* 모바일 환경에서 언어 선택 목록 상자의 위치 조정 */
        @media (max-width: 600px) {
            .language-selector {
                top: 5px;
                right: 5px;
            }
            .language-selector select {
                font-size: 0.85rem;
                padding: 4px 8px;
            }
        }
    </style>
</head>
<body>
    <main>
        <!-- 언어 선택 목록 상자 추가 --><div class="language-selector">
            <label for="language-select">언어:</label>
            <select id="language-select">
                <option value="ko" selected>한국어</option>
                <option value="en">English</option>
                <option value="jp">日本語</option>
                <option value="cn">中文</option>
            </select>
        </div>

        <div id="start-page" class="page active">
            <h1>본캐찾기</h1>
            <div class="form-box">
                <div class="form-inner-container">
                    <div class="form-row">
                        <div class="input-group">
                            <label for="age-select">나이:</label>
                            <select name="age" id="age-select">
                                <option value="">-- 선택 --</option>
                                <option value="10s">10대</option>
                                <option value="20s">20대</option>
                                <option value="30s">30대</option>
                                <option value="40s">40대</option>
                                <option value="50s">50대</option>
                                <option value="60s">60대</option>
                                <option value="70s_plus">70대 이상</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="gender-select">성별:</label>
                            <select name="gender" id="gender-select">
                                <option value="">-- 선택 --</option>
                                <option value="male">남성</option>
                                <option value="female">여성</option>
                            </select>
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="mbti-input">MBTI:</label>
                        <input type="text" id="mbti-input" placeholder="예) ISTJ, istj" maxlength="4">
                    </div>
                </div>
            </div>
            <div class="button-container">
                <button id="start-btn">테스트 시작하기</button>
            </div>
        </div>

        <div id="question-page" class="page">
            <div class="question-container">
                <div class="progress-text" id="progress-text">1 / 20</div>
                <div class="progress-bar">
                    <div class="progress" id="progress"></div>
                </div>
                <div id="question-nav" class="question-nav"></div>
                <div class="question-box">
                    <h2 id="question-title">Q1. 질문 내용이 여기에 표시됩니다.</h2>
                    <img id="question-image" src="https://github.com/ccuvely44/task001/blob/main/images/Image001.jpg?raw=true" alt="질문 이미지" class="question-image">
                    <div class="options" id="options">
                        </div>
                </div>
                <div class="button-container">
                    <button id="prev-btn">&larr; 이전</button>
                    <button id="home-btn">홈</button>
                    <button id="next-btn">다음 &rarr;</button>
                </div>
            </div>
        </div>

        <div id="result-page" class="page">
            <div class="result-box">
                <h2 id="result-title"></h2>
                <p id="result-subtitle"></p>

                <div class="result-section">
                    <h3>나의 성향 분석</h3>
                    <div class="percentage-container">
                        <div id="teto-bar" class="percentage-bar teto-bar"></div>
                        <div id="egen-bar" class="percentage-bar egen-bar"></div>
                    </div>
                    <div class="percentage-labels">
                        <span>테토 (Teto)</span>
                        <span>에겐 (Egen)</span>
                    </div>

                    <h4>나의 핵심태그</h4>

                    <div id="keyword-container" class="keyword-container">
                        </div>

                    <h4>나의 성격태그</h4>

                    <div id="trait-tag-container" class="keyword-container">
                        </div>
                </div>

                <div class="result-section">
                    <h3>나와 잘 맞는 성향</h3>
                    <p id="compatible-type" style="font-size: 1.3rem; font-weight: bold; margin-bottom: 0;"></p>

                    <h4>나와 잘 맞는 성향의 핵심태그</h4>
                    <div id="compatible-keyword-container" class="keyword-container">
                        </div>

                    <h4>나와 잘 맞는 성향의 성격태그</h4>
                    <div id="compatible-trait-container" class="keyword-container">
                        </div>
                </div>

                <div class="result-section">
                    <h3 id="mbti-section-title">이 성향의 MBTI TOP 3</h3>
                    <div id="mbti-tags" class="mbti-tags"></div>
                </div>

                <div class="button-container">
                    <button id="restart-btn">다시하기</button>
                </div>
            </div>
        </div>
    </main>

    <div id="warning-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>잠깐만요!</h3>
            <p id="modal-message"></p>
            <button id="modal-close-btn">확인</button>
        </div>
    </div>

    <div id="loading-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="spinner"></div>
            <p style="margin-bottom: 0;">분석중...</p>
        </div>
    </div>


    <script>
        const allQuestions = [
            { ko: "나는 새로운 사람들을 만나는 것을 즐긴다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image001.jpg?raw=true", type: 'Egen' },
            { ko: "나는 파티나 모임에서 중심에 있는 것을 좋아한다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image002.jpg?raw=true", type: 'Egen' },
            { ko: "나는 분위기를 띄우기 위해 농담이나 재미있는 이야기를 자주 하는 편이다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image003.jpg?raw=true", type: 'Egen' },
            { ko: "나는 팀 프로젝트에서 리더 역할을 맡는 것을 선호한다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image004.jpg?raw=true", type: 'Egen' },
            { ko: "나는 다른 사람에게 도움을 요청하는 것을 주저하지 않는다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image005.jpg?raw=true", type: 'Egen' },
            { ko: "나는 종종 다른 사람의 감정에 깊이 공감한다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image006.jpg?raw=true", type: 'Egen' },
            { ko: "다른 사람의 행복을 위해 나의 시간을 기꺼이 사용한다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image007.jpg?raw=true", type: 'Egen' },
            { ko: "나는 예술 작품이나 자연의 아름다움에 쉽게 감동받는다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image008.jpg?raw=true", type: 'Egen' },
            { ko: "슬픈 영화나 드라마를 보면 눈물이 나는 경우가 많다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image009.jpg?raw=true", type: 'Egen' },
            { ko: "나는 나의 감정을 다른 사람에게 표현하는 것이 어렵지 않다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image010.jpg?raw=true", type: 'Egen' },
            { ko: "나는 다른 사람을 칭찬하는 데 인색하지 않다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image011.jpg?raw=true", type: 'Egen' },
            { ko: "나는 다른 사람의 부탁을 거절하는 것을 어려워한다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image012.jpg?raw=true", type: 'Egen' },
            { ko: "나는 다른 사람의 성공에 진심으로 기뻐할 수 있다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image013.jpg?raw=true", type: 'Egen' },
            { ko: "나는 나의 직감을 믿고 행동하는 경우가 많다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image014.jpg?raw=true", type: 'Egen' },
            { ko: "나는 기념일이나 특별한 날을 챙기는 것을 중요하게 생각한다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image015.jpg?raw=true", type: 'Egen' },
            { ko: "나는 갑작스러운 계획 변경에도 유연하게 대처할 수 있다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image016.jpg?raw=true", type: 'Egen' },
            { ko: "나는 위험을 감수하더라도 새로운 도전을 하는 것을 즐긴다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image017.jpg?raw=true", type: 'Egen' },
            { ko: "새로운 기기를 샀을 때, 설명서를 읽기보다 일단 직접 사용해보는 편이다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image018.jpg?raw=true", type: 'Egen' },
            { ko: "나는 결과보다는 과정이 더 중요하다고 생각한다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image019.jpg?raw=true", type: 'Egen' },
            { ko: "나는 모르는 것이 있으면 즉시 질문하거나 찾아보는 편이다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image020.jpg?raw=true", type: 'Egen' },
            { ko: "나는 새로운 아이디어나 추상적인 개념에 대해 생각하는 것을 즐긴다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image021.jpg?raw=true", type: 'Egen' },
            { ko: "나는 패션이나 스타일에 관심이 많은 편이다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image022.jpg?raw=true", type: 'Egen' },
            { ko: "나는 복잡한 문제의 본질을 파악하는 것을 즐긴다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image023.jpg?raw=true", type: 'Egen' },
            { ko: "나는 영화를 볼 때 스토리보다 영상미를 더 중요하게 생각한다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image024.jpg?raw=true", type: 'Egen' },
            { ko: "나는 사람들과의 약속을 중요하게 생각한다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image025.jpg?raw=true", type: 'Egen' },

            { ko: "나는 단체 활동보다 혼자 하는 활동이 더 편안하다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image026.jpg?raw=true", type: 'Teto' },
            { ko: "나는 여러 사람과 어울리기보다 소수의 깊은 관계를 선호한다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image027.jpg?raw=true", type: 'Teto' },
            { ko: "나는 대화 중에 침묵이 흘러도 불편하지 않다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image028.jpg?raw=true", type: 'Teto' },
            { ko: "나는 혼자만의 시간을 갖는 것이 재충전에 꼭 필요하다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image029.jpg?raw=true", type: 'Teto' },
            { ko: "나는 갈등이 생겼을 때, 직접 부딪혀 해결하려는 편이다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image030.jpg?raw=true", type: 'Teto' },
            { ko: "나는 사소한 일에 감정적으로 동요하지 않는 편이다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image031.jpg?raw=true", type: 'Teto' },
            { ko: "나는 종종 미래에 대해 걱정하기보다 현재에 집중한다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image032.jpg?raw=true", type: 'Teto' },
            { ko: "나는 과거의 실수에 대해 오랫동안 생각하지 않으려 한다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image033.jpg?raw=true", type: 'Teto' },
            { ko: "문제가 발생하면 감정적으로 대처하기보다 차분하게 분석하는 편이다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image034.jpg?raw=true", type: 'Teto' },
            { ko: "나는 힘든 일이 있어도 긍정적인 태도를 유지하려고 노력한다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image035.jpg?raw=true", type: 'Teto' },
            { ko: "나는 계획을 세우고 그것을 따르는 것을 좋아한다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image036.jpg?raw=true", type: 'Teto' },
            { ko: "나는 내 방이나 책상을 항상 깔끔하게 정리해 둔다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image037.jpg?raw=true", type: 'Teto' },
            { ko: "나는 결정을 내릴 때, 논리적인 근거를 중요하게 생각한다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image038.jpg?raw=true", type: 'Teto' },
            { ko: "나는 쇼핑할 때, 디자인보다 실용성을 더 중요하게 생각한다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image039.jpg?raw=true", type: 'Teto' },
            { ko: "어떤 일이든 시작하기 전에 여러 가능성을 충분히 고려한다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image040.jpg?raw=true", type: 'Teto' },
            { ko: "나는 한 번에 한 가지 일에 집중하는 것을 더 잘한다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image041.jpg?raw=true", type: 'Teto' },
            { ko: "나는 효율성과 생산성을 중요하게 생각한다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image042.jpg?raw=true", type: 'Teto' },
            { ko: "나는 목표를 달성하기 위해 체계적으로 접근한다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image043.jpg?raw=true", type: 'Teto' },
            { ko: "나는 규칙이나 절차를 따르는 것이 편안하다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image044.jpg?raw=true", type: 'Teto' },
            { ko: "나는 돈이나 시간을 관리하는 데 능숙하다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image045.jpg?raw=true", type: 'Teto' },
            { ko: "나는 경쟁에서 이기는 것에서 큰 성취감을 느낀다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image046.jpg?raw=true", type: 'Teto' },
            { ko: "나는 대화할 때 사실과 정보를 기반으로 이야기하는 것을 선호한다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image047.jpg?raw=true", type: 'Teto' },
            { ko: "나는 감성적인 선물보다 실용적인 선물을 더 선호한다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image048.jpg?raw=true", type: 'Teto' },
            { ko: "나는 다른 사람의 의견에 쉽게 동의하기보다 비판적으로 검토하는 편이다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image049.jpg?raw=true", type: 'Teto' },
            { ko: "나는 토론에서 내 주장을 논리적으로 방어하는 것을 잘한다.", image: "https://github.com/ccuvely44/task001/blob/main/images/Image050.jpg?raw=true", type: 'Teto' },
        ];

        const optionsData = [
            { ko: "매우 그렇지 않다", value: 1 },
            { ko: "그렇지 않다", value: 2 },
            { ko: "보통이다", value: 3 },
            { ko: "그렇다", value: 4 },
            { ko: "매우 그렇다", value: 5 }
        ];

        const validMbtiTypes = [
            'istj', 'istp', 'isfj', 'isfp', 'intj', 'intp', 'infj', 'infp',
            'estj', 'estp', 'esfj', 'esfp', 'entj', 'entp', 'enfj', 'enfp'
        ];

        const resultKeywords = {
            Balance: ['#합리적인', '#균형잡힌', '#유연한', '#포용력있는', '#평화주의'],
            TetoMale: ['#논리적인', '#계획적인', '#현실적인', '#분석적인', '#원칙주의'],
            TetoFemale: ['#논리적인', '#체계적인', '#똑부러지는', '#효율적인', '#완벽주의'],
            EgenMale: ['#다정한', '#사교적인', '#유쾌한', '##공감하는', '#낙천주의'],
            EgenFemale: ['#감성적인', '#따뜻한', '#관계지향적', '#창의적인', '#낭만주의']
        };

        const resultTraits = {
            Balance: [
                '#논리와 감성의 조화를 이루는 균형잡힌 성향입니다.',
                '#상황에 따라 유연하게 대처하는 합리적인 중재자입니다.',
                '#갈등을 싫어하며 평화로운 관계를 중요하게 생각합니다.',
                '#양쪽의 의견을 모두 경청하는 포용력을 가졌습니다.',
                '#다양한 관점을 이해하려 노력하는 성격입니다.'
            ],
            TetoMale: [
                '#논리와 계획으로 듬직하게 팀을 이끄는 성격입니다.',
                '#감정 표현보다는 현실적인 해결책을 제시합니다.',
                '#원칙을 중요시하며 체계적으로 접근하는 것을 선호합니다.',
                '#목표 지향적이며 효율성을 중요하게 생각합니다.',
                '#사실에 기반한 명확한 커뮤니케이션을 합니다.'
            ],
            TetoFemale: [
                '#체계적인 사고로 똑 부러지게 문제를 해결하는 성격입니다.',
                '#감정적인 동요 없이 이성적으로 판단하는 능력이 뛰어납니다.',
                '#효율성을 중시하며 완벽하게 일을 처리하려 합니다.',
                '#명확한 기준과 논리적인 근거를 중요하게 생각합니다.',
                '#현실적인 감각으로 안정적인 삶을 추구합니다.'
            ],
            EgenMale: [
                '#풍부한 공감 능력으로 주변을 따뜻하게 챙기는 성격입니다.',
                '#다정하고 사교적이며 유쾌한 성격으로 분위기를 주도합니다.',
                '#규칙보다는 유연한 사고로 상황에 대처합니다.',
                '#사람들과의 관계를 중요시하는 낙천주의자입니다.',
                '#새로운 경험과 도전을 즐기는 긍정적인 성향입니다.'
            ],
            EgenFemale: [
                '#다정한 감수성과 유연한 사고로 소통하는 성격입니다.',
                '#타인의 감정을 잘 읽어내고 깊이 공감하는 능력이 뛰어납니다.',
                '#관계 지향적이며 주변 사람들에게 따뜻한 지지를 보냅니다.',
                '#창의적인 아이디어가 많고 미적 감각이 뛰어납니다.',
                '#낭만적인 것을 좋아하며 감정 표현에 솔직한 편입니다.'
            ]
        };

        const realisticMbtiData = {
            TetoMale: ['ENFP', 'ESFP', 'ESFJ'],
            TetoFemale: ['INFP', 'ENFJ', 'ISFP'],
            EgenMale: ['ISTJ', 'ESTJ', 'ENTJ'],
            EgenFemale: ['INTJ', 'ISTP', 'INTP'],
            Balance: ['ISTP', 'ENFJ', 'ISFJ']
        };
        
        const mbtiDescriptions = {
            'ISTJ': '신중하고 현실적이며, 원리원칙을 중요시하는 믿음직한 책임자입니다.',
            'INTJ': '높은 지능과 통찰력을 바탕으로 장기적인 전략을 수립하는 뛰어난 설계자입니다.',
            'ESTJ': '체계적이고 논리적이며, 목표 달성을 위해 팀을 효율적으로 이끄는 카리스마 있는 리더입니다.',
            'ISTP': '조용하고 관찰력이 뛰어나며, 기계나 도구를 다루는 데 재능이 있는 만능 재주꾼입니다.',
            'INTP': '끊임없이 탐구하고 분석하며, 복잡한 문제에 대한 논리적인 해결책을 찾아내는 지적 탐험가입니다.',
            'ISFJ': '배려심이 깊고 헌신적이며, 조용히 주변 사람들을 돕는 따뜻한 마음의 수호자입니다.',
            'INFP': '이상주의적이고 상상력이 풍부하며, 진정한 가치를 추구하는 잔잔한 몽상가입니다.',
            'ENFP': '열정적이고 재기발랄하며, 사람들과 새로운 가능성을 탐색하는 매력적인 활동가입니다.',
            'ESFP': '자유분방하고 사교적이며, 현재를 즐기고 주변 분위기를 유쾌하게 만드는 천상 연예인입니다.',
            'ENFJ': '정의롭고 카리스마가 있으며, 타인의 잠재력을 이끌어내는 능력이 뛰어난 선도자입니다.',
            'ESFJ': '친절하고 사교성이 뛰어나며, 주변 사람들과의 관계를 원만하게 유지하는 다정한 사교가입니다.',
            'ENTJ': '타고난 리더십과 뛰어난 논리력을 바탕으로 대담하게 목표를 밀어붙이는 지휘관입니다.',
            'ISFP': '호기심 많고 예술적 감각이 뛰어나며, 삶을 즐기는 자유로운 영혼의 탐험가입니다.',
            'ENTP': '지적 호기심이 넘치고 논쟁을 즐기며, 끊임없이 새로운 아이디어를 창출하는 발명가입니다.',
            'INFJ': '통찰력이 뛰어나고 이상주의적이며, 세상을 더 나은 곳으로 만들고자 노력하는 옹호자입니다.',
            'ESTP': '넘치는 에너지로 문제를 즉각적으로 해결하며, 행동을 통해 배우는 활동적인 사업가입니다.'
        };


        let randomQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let lastResultData = null;
        let selectedGender = '';
        let selectedAge = '';
        let selectedMbti = '';

        const startPage = document.getElementById('start-page');
        const questionPage = document.getElementById('question-page');
        const resultPage = document.getElementById('result-page');

        const startBtn = document.getElementById('start-btn');
        const nextBtn = document.getElementById('next-btn');
        const prevBtn = document.getElementById('prev-btn');
        const homeBtn = document.getElementById('home-btn');
        const restartBtn = document.getElementById('restart-btn');

        const progressText = document.getElementById('progress-text');
        const progress = document.getElementById('progress');
        const questionTitle = document.getElementById('question-title');
        const questionImage = document.getElementById('question-image');
        const optionsContainer = document.getElementById('options');
        const questionNav = document.getElementById('question-nav');

        const warningModal = document.getElementById('warning-modal');
        const modalMessage = document.getElementById('modal-message');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const loadingModal = document.getElementById('loading-modal');
        const mbtiInput = document.getElementById('mbti-input');


        function renderResultText() {
            if (!lastResultData) return;

            const { titleText, subtitleText, compatibleText, mbtiTop3, mbtiTitleText, keywords, traits, compatibleKeywords, compatibleTraits } = lastResultData;

            document.getElementById('result-title').innerText = titleText;
            document.getElementById('result-subtitle').innerText = subtitleText;
            document.getElementById('compatible-type').innerText = compatibleText;
            document.getElementById('mbti-section-title').innerText = mbtiTitleText;

            const mbtiContainer = document.getElementById('mbti-tags');
            mbtiContainer.innerHTML = '';
            
            mbtiTop3.forEach(mbti => {
                const description = mbtiDescriptions[mbti] || "설명 없음";
                
                const itemDiv = document.createElement('div');
                itemDiv.classList.add('mbti-tag-item');
                
                itemDiv.innerHTML += `<div class="mbti-tag">${mbti}</div>`;
                
                itemDiv.innerHTML += `<p class="mbti-description">${description}</p>`;
                
                mbtiContainer.appendChild(itemDiv);
            });

            const keywordContainer = document.getElementById('keyword-container');
            keywordContainer.innerHTML = '';
            if (keywords && keywords.length > 0) {
                keywords.forEach(keyword => {
                    keywordContainer.innerHTML += `<div class="keyword-tag">${keyword}</div>`;
                });
            }

            const traitContainer = document.getElementById('trait-tag-container');
            traitContainer.innerHTML = '';
            if (traits && traits.length > 0) {
                traits.forEach(traitSentence => {
                    traitContainer.innerHTML += `<div class="keyword-tag">${traitSentence}</div>`;
                });
            }

            const compatibleKeywordContainer = document.getElementById('compatible-keyword-container');
            compatibleKeywordContainer.innerHTML = '';
            if (compatibleKeywords && compatibleKeywords.length > 0) {
                compatibleKeywords.forEach(keyword => {
                    compatibleKeywordContainer.innerHTML += `<div class="keyword-tag">${keyword}</div>`;
                });
            }

            const compatibleTraitContainer = document.getElementById('compatible-trait-container');
            compatibleTraitContainer.innerHTML = '';
            if (compatibleTraits && compatibleTraits.length > 0) {
                compatibleTraits.forEach(traitSentence => {
                    compatibleTraitContainer.innerHTML += `<div class="keyword-tag">${traitSentence}</div>`;
                });
            }
        }


        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }

        function showModal(message, noWrap = false) {
            modalMessage.innerText = message;
            if (noWrap) {
                modalMessage.style.whiteSpace = 'nowrap';
            } else {
                modalMessage.style.whiteSpace = 'normal';
                modalMessage.style.wordBreak = 'keep-all';
            }
            warningModal.classList.add('visible');
        }

        function closeModal() {
            warningModal.classList.remove('visible');
        }

        function resetTest() {
            randomQuestions = [];
            currentQuestionIndex = 0;
            userAnswers = [];
            lastResultData = null;
            selectedGender = '';
            selectedAge = '';
            selectedMbti = '';
            progress.style.width = '0%';

            document.getElementById('age-select').value = "";
            document.getElementById('gender-select').value = "";
            document.getElementById('mbti-input').value = "";

            showPage('start-page');
        }

        function startTest() {
            selectedAge = document.getElementById('age-select').value;
            selectedGender = document.getElementById('gender-select').value;
            selectedMbti = mbtiInput.value.trim().toLowerCase();

            const tetoQuestions = allQuestions.filter(q => q.type === 'Teto').sort(() => 0.5 - Math.random()).slice(0, 10);
            const egenQuestions = allQuestions.filter(q => q.type === 'Egen').sort(() => 0.5 - Math.random()).slice(0, 10);

            randomQuestions = [...tetoQuestions, ...egenQuestions].sort(() => 0.5 - Math.random());

            currentQuestionIndex = 0;
            userAnswers = Array(20).fill(null);

            questionNav.innerHTML = '';
            for (let i = 0; i < randomQuestions.length; i++) {
                const navItem = document.createElement('div');
                navItem.classList.add('nav-item');
                navItem.innerText = i + 1;
                navItem.addEventListener('click', () => jumpToQuestion(i));
                questionNav.appendChild(navItem);
            }

            showQuestion(currentQuestionIndex);
            showPage('question-page');
        }

        function jumpToQuestion(index) {
            currentQuestionIndex = index;
            showQuestion(currentQuestionIndex);
        }

        function showQuestion(index) {
            const question = randomQuestions[index];

            progressText.innerText = `${index + 1} / ${randomQuestions.length}`;
            progress.style.width = `${((index + 1) / randomQuestions.length) * 100}%`;

            questionTitle.innerHTML = `<span>Q${index + 1}.</span><span>${question.ko}</span>`;

            questionImage.src = question.image;
            questionImage.alt = question.ko;

            optionsContainer.innerHTML = '';
            optionsData.forEach(option => {
                const optionId = `q${index}_opt${option.value}`;
                optionsContainer.innerHTML += `
                    <input type="radio" name="q${index}" value="${option.value}" id="${optionId}" class="option-input">
                    <label for="${optionId}" class="option-label">${option.ko}</label>
                `;
            });

            const radioButtons = document.querySelectorAll(`input[name="q${index}"]`);
            radioButtons.forEach(radio => {
                radio.addEventListener('change', (event) => {
                    userAnswers[index] = { question: question.ko, answer: parseInt(event.target.value) };
                    updateNavItems();
                });
            });

            if (userAnswers[index]) {
                const selectedValue = userAnswers[index].answer;
                const radioToSelect = document.getElementById(`q${index}_opt${selectedValue}`);
                if (radioToSelect) {
                    radioToSelect.checked = true;
                }
            }

            prevBtn.style.visibility = (index === 0) ? 'hidden' : 'visible';

            if (index === randomQuestions.length - 1) {
                nextBtn.innerText = "결과 보기";
            } else {
                nextBtn.innerText = "다음 →";
            }

            updateNavItems();
        }

        function updateNavItems() {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach((item, itemIndex) => {
                item.classList.remove('active', 'unanswered', 'answered');
                if (userAnswers[itemIndex] === null) {
                    if (itemIndex < currentQuestionIndex) {
                        item.classList.add('unanswered');
                    }
                } else {
                    item.classList.add('answered');
                }
            });
            if (navItems[currentQuestionIndex]) {
                 navItems[currentQuestionIndex].classList.remove('unanswered', 'answered');
                 navItems[currentQuestionIndex].classList.add('active');
            }
        }


        function showResult() {
            loadingModal.classList.add('visible');

            setTimeout(() => {
                let tetoScore = 0, egenScore = 0;
                let tetoCount = 0, egenCount = 0;

                userAnswers.forEach((answer, index) => {
                    if (!answer) return;
                    const question = randomQuestions[index];
                    let currentScore = answer.answer;

                    if (question.type === 'Teto') {
                        tetoScore += currentScore;
                        tetoCount++;
                    } else {
                        egenScore += currentScore;
                        egenCount++;
                    }
                });

                let ageBonusTeto = 0;
                let ageBonusEgen = 0;

                switch (selectedAge) {
                    case '10s':
                    case '20s':
                        ageBonusEgen = 2;
                        break;
                    case '50s':
                    case '60s':
                    case '70s_plus':
                        ageBonusTeto = 2;
                        break;
                }

                let mbtiBonusTeto = 0;
                let mbtiBonusEgen = 0;

                if (selectedMbti.includes('t') || selectedMbti.includes('j')) {
                    mbtiBonusTeto = 3;
                }
                if (selectedMbti.includes('f') || selectedMbti.includes('p')) {
                    mbtiBonusEgen = 3;
                }

                tetoScore += ageBonusTeto + mbtiBonusTeto;
                egenScore += ageBonusEgen + mbtiBonusEgen;

                const totalTeto = tetoCount > 0 ? (tetoScore - (tetoCount*1)) / (tetoCount * 4) : 0;
                const totalEgen = egenCount > 0 ? (egenScore - (egenCount*1)) / (egenCount * 4) : 0;

                const totalSum = totalTeto + totalEgen;
                const tetoPercentage = totalSum > 0 ? Math.round((totalTeto / totalSum) * 100) : 50;
                const egenPercentage = 100 - tetoPercentage;

                let mbtiTop3;
                let titleText, subtitleText, compatibleText, mbtiTitleText;
                let selectedKeywords, selectedTraits, compatibleKeywordsKey, compatibleTraitsKey, mbtiKey;

                if (Math.abs(tetoPercentage - egenPercentage) < 6) {
                    titleText = "균형잡힌 중재자";
                    subtitleText = "논리와 감성의 조화를 이루는 균형잡힌 당신.";
                    compatibleText = "모든 성향과 잘 어울려요!";
                    mbtiKey = 'Balance';
                    mbtiTitleText = "이 성향의 MBTI TOP 3";
                    selectedKeywords = resultKeywords.Balance;
                    selectedTraits = resultTraits.Balance;
                    compatibleKeywordsKey = 'Balance';
                    compatibleTraitsKey = 'Balance';
                } else if (tetoPercentage > egenPercentage) {
                    const isMale = selectedGender === 'male';
                    titleText = isMale ? "논리적인 분석가, 테토남" : "논리적인 분석가, 테토녀";
                    subtitleText = isMale ? "논리와 계획으로 듬직하게 팀을 이끄는 당신." : "체계적인 사고로 똑 부러지게 문제를 해결하는 당신.";
                    compatibleText = isMale ? "따뜻한 공감가, 에겐녀" : "따뜻한 공감가, 에겐남";
                    mbtiKey = isMale ? 'TetoMale' : 'TetoFemale';
                    mbtiTitleText = "나와 잘 맞는 성향의 MBTI TOP 3";
                    selectedKeywords = isMale ? resultKeywords.TetoMale : resultKeywords.TetoFemale;
                    selectedTraits = isMale ? resultTraits.TetoMale : resultTraits.TetoFemale;
                    compatibleKeywordsKey = isMale ? 'EgenFemale' : 'EgenMale';
                    compatibleTraitsKey = isMale ? 'EgenFemale' : 'EgenMale';
                } else {
                    const isMale = selectedGender === 'male';
                    titleText = isMale ? "따뜻한 공감가, 에겐남" : "따뜻한 공감가, 에겐녀";
                    subtitleText = isMale ? "풍부한 공감 능력으로 주변을 따뜻하게 챙기는 당신." : "다정한 감수성과 유연한 사고로 소통하는 당신.";
                    compatibleText = isMale ? "논리적인 분석가, 테토녀" : "논리적인 분석가, 테토남";
                    mbtiKey = isMale ? 'EgenMale' : 'EgenFemale';
                    mbtiTitleText = "나와 잘 맞는 성향의 MBTI TOP 3";
                    selectedKeywords = isMale ? resultKeywords.EgenMale : resultKeywords.EgenFemale;
                    selectedTraits = isMale ? resultTraits.EgenMale : resultTraits.EgenFemale;
                    compatibleKeywordsKey = isMale ? 'TetoFemale' : 'TetoMale';
                    compatibleTraitsKey = isMale ? 'TetoFemale' : 'TetoMale';
                }

                let compatibleMbtiKey = '';
                 if (mbtiKey === 'Balance') {
                    compatibleMbtiKey = 'Balance';
                 } else if (mbtiKey === 'TetoMale') {
                    compatibleMbtiKey = 'EgenFemale';
                 } else if (mbtiKey === 'TetoFemale') {
                    compatibleMbtiKey = 'EgenMale';
                 } else if (mbtiKey === 'EgenMale') {
                    compatibleMbtiKey = 'TetoFemale';
                 } else {
                    compatibleMbtiKey = 'TetoMale';
                 }

                mbtiTop3 = realisticMbtiData[compatibleMbtiKey] || []; 

                const randomKeywords = selectedKeywords
                                            .sort(() => 0.5 - Math.random())
                                            .slice(0, 3);

                const randomTraits = selectedTraits
                                            .sort(() => 0.5 - Math.random())
                                            .slice(0, 3);

                const compatibleKeywordsData = resultKeywords[compatibleKeywordsKey] || [];
                const compatibleTraitsData = resultTraits[compatibleTraitsKey] || [];

                const randomCompatibleKeywords = compatibleKeywordsData
                                            .sort(() => 0.5 - Math.random())
                                            .slice(0, 3);
                const randomCompatibleTraits = compatibleTraitsData
                                            .sort(() => 0.5 - Math.random())
                                            .slice(0, 3);

                lastResultData = {
                    titleText,
                    subtitleText,
                    compatibleText,
                    mbtiTop3,
                    mbtiTitleText,
                    keywords: randomKeywords,
                    traits: randomTraits,
                    compatibleKeywords: randomCompatibleKeywords,
                    compatibleTraits: randomCompatibleTraits
                };

                renderResultText();

                const tetoBar = document.getElementById('teto-bar');
                const egenBar = document.getElementById('egen-bar');
                tetoBar.style.width = tetoPercentage + '%';
                tetoBar.innerText = tetoPercentage + '%';
                egenBar.style.width = egenPercentage + '%';
                egenBar.innerText = egenPercentage + '%';

                loadingModal.classList.remove('visible');
                showPage('result-page');

            }, 3000);
        }

        startBtn.addEventListener('click', () => {
            const age = document.getElementById('age-select').value;
            const gender = document.getElementById('gender-select').value;
            const mbtiValue = mbtiInput.value.trim();

            if (age === "" || gender === "" || mbtiValue === "") {
                showModal("나이, 성별, MBTI를 모두 입력해주세요!");
                return;
            }

            if (!validMbtiTypes.includes(mbtiValue.toLowerCase())) {
                 showModal("유효하지 않은 MBTI 유형입니다.", true);
                 return;
            }

            startTest();
        });

        nextBtn.addEventListener('click', () => {
            const selectedOption = document.querySelector(`input[name="q${currentQuestionIndex}"]:checked`);
             if (!selectedOption && userAnswers[currentQuestionIndex] === null) {
                userAnswers[currentQuestionIndex] = null;
            }
            updateNavItems();


            if (currentQuestionIndex === randomQuestions.length - 1) {
                const unansweredQuestions = [];
                userAnswers.forEach((answer, index) => {
                    if (answer === null) {
                        unansweredQuestions.push(index + 1);
                    }
                });

                if (unansweredQuestions.length > 0) {
                    const formattedUnanswered = unansweredQuestions.map(num => `Q${num}`).join(', ');
                    showModal(`답변하지 않은 질문이 있습니다:\n${formattedUnanswered}`);
                } else {
                    showResult();
                }
            } else {
                currentQuestionIndex++;
                showQuestion(currentQuestionIndex);
            }
        });

        prevBtn.addEventListener('click', () => {
            const selectedOption = document.querySelector(`input[name="q${currentQuestionIndex}"]:checked`);
             if (!selectedOption && userAnswers[currentQuestionIndex] === null) {
                userAnswers[currentQuestionIndex] = null;
            }
             updateNavItems();

            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion(currentQuestionIndex);
            }
        });

        modalCloseBtn.addEventListener('click', closeModal);
        warningModal.addEventListener('click', (event) => {
            if (event.target === warningModal) {
                closeModal();
            }
        });

        homeBtn.addEventListener('click', resetTest);
        restartBtn.addEventListener('click', resetTest);

    </script>
</body>
</html>
